var APIShieldAgent=(()=>{var S=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames;var C=Object.prototype.hasOwnProperty;var D=(n,t)=>{for(var e in t)S(n,e,{get:t[e],enumerable:!0})},q=(n,t,e,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let u of b(t))!C.call(n,u)&&u!==e&&S(n,u,{get:()=>t[u],enumerable:!(a=N(t,u))||a.enumerable});return n};var B=n=>q(S({},"__esModule",{value:!0}),n);var te={};D(te,{EVENT_TYPES:()=>l,createAgent:()=>A,initAgent:()=>U});var l={PAGE_VIEW:"page_view",CLICK:"click",SCROLL:"scroll",FORM_SUBMIT:"form_submit",ERROR:"error"},I="__api_shield_session_id",F=4096,x=200,K=3e3,G=20,H=10,V=1e3,j={[l.CLICK]:["tag","id","classes"],[l.SCROLL]:["depth"],[l.FORM_SUBMIT]:["form_id","form_name","form_action","form_method"],[l.ERROR]:["message","source","lineno","colno","reason"],[l.PAGE_VIEW]:[]};function _(){return typeof window<"u"&&typeof document<"u"}function z(){return new Date().toISOString()}function m(){if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID();let n=typeof crypto<"u"&&crypto.getRandomValues?crypto.getRandomValues(new Uint8Array(16)):Array.from({length:16},()=>Math.floor(Math.random()*256));n[6]=n[6]&15|64,n[8]=n[8]&63|128;let t=Array.from(n,e=>e.toString(16).padStart(2,"0")).join("");return`${t.slice(0,8)}-${t.slice(8,12)}-${t.slice(12,16)}-${t.slice(16,20)}-${t.slice(20)}`}function $(){try{return window.sessionStorage}catch{return null}}function f(){let n=$();if(n){let t=n.getItem(I);if(t)return t;let e=`s_${m()}`;return n.setItem(I,e),e}return f._fallback||(f._fallback=`s_${m()}`),f._fallback}function Q(n){if(n)return n;if(!_())return null;if(window.__API_SHIELD_KEY__)return window.__API_SHIELD_KEY__;let t=document.currentScript;if(t&&t.dataset&&t.dataset.key)return t.dataset.key;let e=document.querySelector("script[data-key]");return e&&e.dataset&&e.dataset.key?e.dataset.key:null}function Y(n){if(n)return n;if(!_())return"/api/v1/ingest/browser";if(window.__API_SHIELD_INGEST_URL__)return window.__API_SHIELD_INGEST_URL__;let t=document.currentScript;if(t&&t.dataset&&t.dataset.endpoint)return t.dataset.endpoint;let e=document.querySelector("script[data-endpoint]");return e&&e.dataset&&e.dataset.endpoint?e.dataset.endpoint:(typeof __AGENT_INGEST_URL__<"u"?__AGENT_INGEST_URL__:"")||"/api/v1/ingest/browser"}function T(n,t){try{let e=new URL(n,window.location.href);return e.hash="",t&&(e.search=""),e.toString()}catch{return n}}function W(n){try{return new URL(n,window.location.href).pathname||"/"}catch{return n&&n.startsWith("/")?n.split("#")[0].split("?")[0]:"/"}}function J(n,t){if(!n)return null;try{if(JSON.stringify(n).length<=t)return n}catch{return{}}return{}}function X(n,t,e,a){if(!t)return null;let u=e[n]||[];if(u.length===0)return null;let h={};for(let c of u)t[c]!==void 0&&t[c]!==null&&(h[c]=t[c]);return J(h,a)}function Z(n){if(!n||typeof n.className!="string")return;let t=n.className.trim();if(t)return t.split(/\s+/).slice(0,6).join(" ")}function ee(n){if(!(!n||!n.action))try{let t=new URL(n.action,window.location.href);return t.hash="",t.search="",t.toString()}catch{return n.action.split("#")[0].split("?")[0]}}function A(n={}){let t={flushIntervalMs:K,flushMaxEvents:G,maxQueueSize:x,scrollStep:H,scrollThrottleMs:V,maxMetaBytes:F,dropUrlQuery:!0,allowBatch:!0,metaAllowlist:j,...n},e={apiKey:Q(t.apiKey),ingestUrl:Y(t.ingestUrl),supportsBatch:!0,queue:[],flushTimer:null,flushPromise:null,lastUrl:null,lastScrollSentAt:0,lastScrollPercent:0,active:!1};function a(r,i,o){if(!_())return null;let s=T(window.location.href,t.dropUrlQuery),k=W(s),O=o!==void 0?o:document.referrer||void 0,P=X(r,i,t.metaAllowlist,t.maxMetaBytes);return{event_id:m(),ts:z(),type:r,url:s,path:k,referrer:O,session_id:f(),meta:P}}function u(r){r&&(e.queue.length>=t.maxQueueSize&&e.queue.shift(),e.queue.push(r),t.onEnqueue&&t.onEnqueue(r),e.queue.length>=t.flushMaxEvents&&c())}async function h(r,i){if(!r.length)return!0;let o={"Content-Type":"application/json","X-Api-Key":e.apiKey};if(e.supportsBatch&&t.allowBatch&&r.length>1){let s=await fetch(e.ingestUrl,{method:"POST",headers:o,body:JSON.stringify({events:r}),keepalive:i}).catch(()=>null);if(s&&s.ok)return!0;s&&[400,404,415,422].includes(s.status)&&(e.supportsBatch=!1)}for(let s of r)await fetch(e.ingestUrl,{method:"POST",headers:o,body:JSON.stringify(s),keepalive:i}).catch(()=>null);return!0}function c(r={}){if(!e.apiKey||!e.ingestUrl||!e.queue.length||e.flushPromise)return;let i=e.queue.splice(0,e.queue.length),o=!!r.keepalive;e.flushPromise=h(i,o).catch(()=>null).finally(()=>{e.flushPromise=null})}function p(r){u(a(l.PAGE_VIEW,null,r))}function E(r){if(!r||r.button!==0)return;let i=r.target&&r.target.nodeType===1?r.target:null,o={tag:i?i.tagName.toLowerCase():void 0,id:i&&i.id?i.id:void 0,classes:Z(i)};u(a(l.CLICK,o))}function w(){let r=Date.now();if(r-e.lastScrollSentAt<t.scrollThrottleMs)return;let i=document.documentElement,o=i.scrollHeight-i.clientHeight;if(o<=0)return;let s=Math.min(100,Math.round(window.scrollY/o*100));s<e.lastScrollPercent+t.scrollStep||(e.lastScrollSentAt=r,e.lastScrollPercent=s,u(a(l.SCROLL,{depth:s})))}function v(){e.lastScrollPercent=0,e.lastScrollSentAt=0}function g(r){let i=r.target;if(!i||i.nodeName!=="FORM")return;let o={form_id:i.id||void 0,form_name:i.name||void 0,form_action:ee(i),form_method:i.method?i.method.toLowerCase():void 0};u(a(l.FORM_SUBMIT,o))}function y(r){let i={message:r.message?String(r.message).slice(0,300):void 0,source:r.filename?String(r.filename).slice(0,200):void 0,lineno:r.lineno,colno:r.colno};u(a(l.ERROR,i))}function L(r){let i=r&&r.reason?String(r.reason).slice(0,300):"unhandledrejection";u(a(l.ERROR,{reason:i}))}function d(){let r=T(window.location.href,t.dropUrlQuery);if(e.lastUrl===null){e.lastUrl=r,p(void 0);return}if(r!==e.lastUrl){let i=e.lastUrl;e.lastUrl=r,v(),p(i)}}function R(){if(e.active||!e.apiKey||!e.ingestUrl)return;e.active=!0,t.flushIntervalMs>0&&(e.flushTimer=window.setInterval(()=>c(),t.flushIntervalMs)),d(),document.addEventListener("click",E,!0),window.addEventListener("scroll",w,{passive:!0}),document.addEventListener("submit",g,!0),window.addEventListener("error",y),window.addEventListener("unhandledrejection",L),window.addEventListener("popstate",d);let r=history.pushState;history.pushState=function(...o){let s=r.apply(this,o);return d(),s};let i=history.replaceState;history.replaceState=function(...o){let s=i.apply(this,o);return d(),s},window.addEventListener("pagehide",()=>c({keepalive:!0})),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&c({keepalive:!0})})}function M(){e.active&&(e.active=!1,e.flushTimer&&(window.clearInterval(e.flushTimer),e.flushTimer=null),document.removeEventListener("click",E,!0),window.removeEventListener("scroll",w),document.removeEventListener("submit",g,!0),window.removeEventListener("error",y),window.removeEventListener("unhandledrejection",L),window.removeEventListener("popstate",d))}return{start:R,stop:M,flush:c,trackPageView:p,getSessionId:f,_queue:e.queue}}function U(n){let t=A(n);return _()&&t.start(),t}_()&&!window.__API_SHIELD_DISABLE_AUTO_INIT__&&(window.APIShieldAgent=U());return B(te);})();
